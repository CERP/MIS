{"ast":null,"code":"import { v4 } from 'uuid';\nexport var saveDB = function saveDB(db) {\n  try {\n    saveAuth(db.auth);\n    saveSyncState(db.sync_state);\n    saveSnapshot(db.last_snapshot);\n    saveQueue(db.queued);\n  } catch (err) {\n    console.error(err);\n  }\n};\nexport var clearDB = function clearDB() {\n  localStorage.removeItem(\"auth\");\n  localStorage.removeItem(\"sync_state\");\n  localStorage.removeItem(\"last_snapshot\");\n  localStorage.removeItem(\"school_db\");\n};\nexport var loadAuth = function loadAuth() {\n  var init_auth = {\n    id: undefined,\n    token: undefined,\n    client_type: \"tech_demo\"\n  };\n\n  try {\n    var str = localStorage.getItem(\"auth\");\n\n    if (str === null) {\n      return init_auth;\n    }\n\n    return JSON.parse(str);\n  } catch (err) {\n    console.error(err);\n    return init_auth;\n  }\n};\nexport var saveAuth = function saveAuth(auth) {\n  localStorage.setItem(\"auth\", JSON.stringify(auth));\n};\n\nvar loadClientId = function loadClientId() {\n  var client_id = localStorage.getItem(\"client_id\") || v4();\n  localStorage.setItem(\"client_id\", client_id);\n  return client_id;\n};\n\nvar loadSyncState = function loadSyncState() {\n  var str = localStorage.getItem(\"sync_state\");\n\n  if (str) {\n    var curr = JSON.parse(str);\n    return curr;\n  }\n\n  return {};\n};\n\nvar saveSyncState = function saveSyncState(sync_state) {\n  localStorage.setItem(\"sync_state\", JSON.stringify(sync_state));\n};\n\nvar saveQueue = function saveQueue(queue) {\n  localStorage.setItem(\"queued\", JSON.stringify(queue));\n};\n\nvar loadQueue = function loadQueue() {\n  return JSON.parse(localStorage.getItem(\"queued\") || \"{}\");\n};\n\nvar saveSnapshot = function saveSnapshot(last_snapshot) {\n  //@ts-ignore\n  localStorage.setItem(\"last_snapshot\", last_snapshot);\n};\n\nvar loadSnapshot = function loadSnapshot() {\n  return parseInt(localStorage.getItem(\"last_snapshot\") || \"0\");\n};\n\nexport var loadDB = function loadDB() {\n  return {\n    client_id: loadClientId(),\n    auth: loadAuth(),\n    queued: loadQueue(),\n    accept_snapshot: false,\n    last_snapshot: loadSnapshot(),\n    connected: false,\n    sync_state: loadSyncState()\n  };\n};","map":{"version":3,"sources":["/home/taimur/dev/cerp/mis/dashboard/src/utils/localStorage.ts"],"names":["v4","saveDB","db","saveAuth","auth","saveSyncState","sync_state","saveSnapshot","last_snapshot","saveQueue","queued","err","console","error","clearDB","localStorage","removeItem","loadAuth","init_auth","id","undefined","token","client_type","str","getItem","JSON","parse","setItem","stringify","loadClientId","client_id","loadSyncState","curr","queue","loadQueue","loadSnapshot","parseInt","loadDB","accept_snapshot","connected"],"mappings":"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","sourcesContent":["import { v4 } from 'uuid';\n\nexport const saveDB = (db : RootReducerState) => {\n\n\ttry {\n\n\t\tsaveAuth(db.auth)\n\t\tsaveSyncState(db.sync_state);\n\t\tsaveSnapshot(db.last_snapshot);\n\t\tsaveQueue(db.queued)\n\t}\n\n\tcatch(err) {\n\t\tconsole.error(err);\n\t}\n}\n\nexport const clearDB = () => {\n\tlocalStorage.removeItem(\"auth\")\n\tlocalStorage.removeItem(\"sync_state\")\n\tlocalStorage.removeItem(\"last_snapshot\")\n\tlocalStorage.removeItem(\"school_db\")\n}\n\nexport const loadAuth = (): RootReducerState['auth'] => {\n\n\tlet init_auth : RootReducerState['auth'] = {\n\t\tid: undefined,\n\t\ttoken: undefined,\n\t\tclient_type: \"tech_demo\"\n\t};\n\n\ttry {\n\t\tconst str = localStorage.getItem(\"auth\")\n\t\tif(str === null) {\n\t\t\treturn init_auth;\n\t\t}\n\n\t\treturn JSON.parse(str);\n\t}\n\tcatch(err) {\n\t\tconsole.error(err);\n\t\treturn init_auth;\n\t}\n}\n\nexport const saveAuth = (auth: RootReducerState['auth']) => {\n\tlocalStorage.setItem(\"auth\", JSON.stringify(auth))\n}\n\nconst loadClientId = () => {\n\n\tconst client_id = localStorage.getItem(\"client_id\") || v4();\n\tlocalStorage.setItem(\"client_id\", client_id)\n\n\treturn client_id;\n}\n\nconst loadSyncState = () : RootReducerState['sync_state'] => {\n\n\tconst str = localStorage.getItem(\"sync_state\");\n\n\tif(str) {\n\t\tconst curr = JSON.parse(str) as RootReducerState['sync_state']\n\t\treturn curr;\n\t}\n\n\treturn {};\n\n}\n\nconst saveSyncState = (sync_state : RootReducerState['sync_state']) => {\n\n\tlocalStorage.setItem(\"sync_state\", JSON.stringify(sync_state));\n}\n\nconst saveQueue = (queue : RootReducerState['queued']) => {\n\n\tlocalStorage.setItem(\"queued\", JSON.stringify(queue))\n\n}\n\nconst loadQueue = () => {\n\treturn JSON.parse(localStorage.getItem(\"queued\") || \"{}\") as RootReducerState['queued']\n}\n\nconst saveSnapshot = (last_snapshot : number) => {\n\n\t//@ts-ignore\n\tlocalStorage.setItem(\"last_snapshot\", last_snapshot);\n}\n\nconst loadSnapshot = () => {\n\treturn parseInt(localStorage.getItem(\"last_snapshot\") || \"0\")\n}\n\nexport const loadDB = () : RootReducerState => {\n\n\treturn {\n\t\tclient_id: loadClientId(),\n\t\tauth: loadAuth(),\n\t\tqueued: loadQueue(),\n\t\taccept_snapshot: false,\n\t\tlast_snapshot: loadSnapshot(),\n\t\tconnected: false,\n\t\tsync_state: loadSyncState()\n\t}\n}\n"]},"metadata":{},"sourceType":"module"}